import { Component } from "react";
import FileDetailsManager from '../contracts/FileDetailsManager.json';

class ContractsManager extends Component{

	constructor(web3) {
		super();
		this.web3 = web3;
		this.accounts = null;
		this.contract = null;
	}

	init =  async (callback) => {

		const { web3 } = this;
		// Use web3 to get the user's accounts.
		const accounts = await web3.eth.getAccounts();

		// Get the contract instance.
		const networkId = await web3.eth.net.getId();
		const deployedNetwork = FileDetailsManager.networks[networkId];
		const instance = new web3.eth.Contract(
			FileDetailsManager.abi,
			deployedNetwork && deployedNetwork.address,
		);

		// Set web3, accounts, and contract to the state, and then proceed with an
		// example of interacting with the contract's methods.
		this.web3 = web3;
		this.accounts = accounts;
		this.contract = instance;

		callback.bind(this)();
	}

	loadDetailsToChain = async (ipfsFileHash, file) => {
		
		const { accounts, contract } = this;

		let date = new Date();
		let dd = String(date.getDate()).padStart(2, '0');
		let mm = String(date.getMonth() + 1).padStart(2, '0'); //January is 0!
		let yyyy = date.getFullYear();

		date = mm + '/' + dd + '/' + yyyy;
		console.log(accounts);
		try {
			await contract.methods.addFile(ipfsFileHash, file.name, file.type, date).send({ from: accounts[0] });
		} catch (error) {
			console.log(error);
		}
        //console.log(await contract.methods.getFiles().call({ from: accounts[0] }));
	}
	
	getFilesDetails = async () => {
		const { accounts, contract } = this;
		let filesDetails = null;
		try {
			filesDetails = await contract.methods.getFiles().call({ from: accounts[0] });
		} catch (error) {
			console.log(error);
		}

		return filesDetails;
	}

	renameFileName = async (fileHash, fileName, newName) => {
		const { accounts, contract } = this;

		console.log(fileHash);
		console.log(fileName);
		console.log(newName);
		try {
			await contract.methods.renameFileName(fileHash, fileName, newName).call({ from: accounts[0] });
		} catch (error) {
			console.log(error);
		}
	}
}

export default ContractsManager;

















































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































