import { Component } from "react";
import FileDetailsManager from '../contracts/FileDetailsManager.json';

class ContractsManager extends Component{

	constructor(web3) {
		super();
		this.web3 = web3;
		this.accounts = null;
		this.contract = null;
	}

	init =  async () => {

		const { web3 } = this;
		// Use web3 to get the user's accounts.
		const accounts = await web3.eth.getAccounts();

		// Get the contract instance.
		const networkId = await web3.eth.net.getId();
		const deployedNetwork = FileDetailsManager.networks[networkId];
		const instance = new web3.eth.Contract(
			FileDetailsManager.abi,
			deployedNetwork && deployedNetwork.address,
		);

		// Set web3, accounts, and contract to the state, and then proceed with an
		// example of interacting with the contract's methods.
		this.web3 = web3;
		this.accounts = accounts;
		this.contract = instance;
	}

	loadDetailsToChain = async (ipfsFileHash, file) => {
		const { web3 } = this;

		console.log("culo1");
		await this.init(web3);

		console.log("culo2");
		const { accounts, contract } = this;

		var date = new Date();
		var dd = String(date.getDate()).padStart(2, '0');
		var mm = String(date.getMonth() + 1).padStart(2, '0'); //January is 0!
		var yyyy = date.getFullYear();

		date = mm + '/' + dd + '/' + yyyy;
		console.log(accounts);
		try {
			await contract.methods.addFile(ipfsFileHash, file.name, file.type, date).send({ from: accounts[0] });
		} catch (error) {
			console.log(error);
		}
        console.log("culone");
	}
}

//const contractsManager = new ContractsManager();
export default ContractsManager;

















































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































